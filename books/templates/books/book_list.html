{% extends "books/base.html" %}
{% load static book_filters %}

{% block content %}

<h1 class="text-2xl font-bold mb-4 dark:text-gray-100">
  Ushbu turkum uchun kitoblar: {{ category.name }}
</h1>

{# inline search box #}
<form method="get" class="mb-4">
  <input
    name="q"
    value="{{ q|default:'' }}"
    placeholder="Turkum ichida qidiruv..."
    class="border border-gray-300 dark:border-gray-600
           bg-white dark:bg-gray-800
           text-gray-900 dark:text-gray-100
           rounded px-3 py-1 w-64
           focus:outline-none focus:ring-2 focus:ring-blue-600"
  />
  <button
    class="ml-2 px-3 py-1 bg-blue-600 text-white rounded
           hover:bg-blue-700 transition-colors">
    Izlash
  </button>
</form>

<div class="grid md:grid-cols-3 gap-4">
  {% for book in books %}
    <div
      class="p-4 bg-white dark:bg-gray-800
             shadow rounded hover:shadow-lg transition-shadow">

      <div class="flex items-start gap-3">
        {% if book.cover %}
          <img src="{{ book.cover.url }}"
               alt="{{ book.title }} Cover"
               class="w-16 h-24 object-cover rounded">
        {% else %}
          {% with extension=book.file|ext %}
            {% if extension == 'pdf' %}
              <i class="fa fa-file-pdf fa-2x text-red-600"></i>
            {% elif extension == 'epub' %}
              <i class="fa fa-book fa-2x text-indigo-600"></i>
            {% elif extension == 'docx' or extension == 'doc' %}
              <i class="fa fa-file-word fa-2x text-blue-700"></i>
            {% else %}
              <i class="fa fa-file fa-2x text-gray-500 dark:text-gray-400"></i>
            {% endif %}
          {% endwith %}
        {% endif %}

        <div>
          <h3 class="font-bold dark:text-gray-100">
            {{ book.title }}
          </h3>
          <p class="text-sm text-gray-600 dark:text-gray-300">
            {{ book.author }}
          </p>
          <a href="{% url 'books:book_detail' book.id %}"
             class="text-blue-600 dark:text-blue-400 text-sm hover:underline">
            Batafsil o'qish
          </a>
        </div>
      </div>
    </div>
  {% empty %}
    <p class="text-gray-600 dark:text-gray-300">
      Afsuski topilmadi
    </p>
  {% endfor %}
</div>

{# Pagination #}
{% if books.has_other_pages %}
  <nav class="mt-6 flex items-center justify-center gap-2 text-sm dark:text-gray-200">

    {% if books.has_previous %}
      <a href="?page={{ books.previous_page_number }}{% if q %}&q={{ q }}{% endif %}"
         class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded
                hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
        Prev
      </a>
    {% else %}
      <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-400 rounded">
        Prev
      </span>
    {% endif %}

    <span>
      Page {{ books.number }} of {{ books.paginator.num_pages }}
    </span>

    {% if books.has_next %}
      <a href="?page={{ books.next_page_number }}{% if q %}&q={{ q }}{% endif %}"
         class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded
                hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
        Next
      </a>
    {% else %}
      <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-400 rounded">
        Next
      </span>
    {% endif %}
  </nav>
{% endif %}

{% endblock %}
